var _t=Object.defineProperty;var Et=(n,t,e)=>t in n?_t(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var L=(n,t,e)=>(Et(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=e(o);fetch(o.href,r)}})();function I(n){return n.length}function xt(n){throw new Error(n)}function st(n){return Promise.resolve().then(n)}function M(n,t,e=0){for(;e<I(n);)t(n[e],e),e++}function R(n){return typeof n=="string"}function A(n){return typeof n=="object"&&n!==null}function Nt(n){return Array.isArray(n)}function U(n){return typeof n=="function"}function Lt(n){return n.toString().slice(0,5)==="class"}function pt(n){return typeof n=="object"&&n[Symbol.toStringTag]==="Promise"}function K(n,t){const e=new WeakSet;function s(o,r){if(A(o)&&A(r)){if(e.has(o)||e.has(r))return!0;e.add(o),e.add(r);const a=Object.keys(o),c=Object.keys(r);if(I(a)!==I(c))return!1;for(const u of a)if(!c.includes(u)||!s(o[u],r[u]))return!1;return!0}else return o===r}return s(n,t)}function D(n){return[null,void 0,!1].includes(n)}function ht(n,t,e){if(typeof t=="string"&&(t=t.split(".")),t.length>1){const s=t.shift();n[s]=n[s]||{},ht(n[s],t,e)}else n[t[0]]=e}function g(n,t={},...e){t||(t={});const s={tag:n,attrs:t,children:(t.children||e).filter(o=>!D(o))};return $(n)&&!I(s.children)&&s.children.push(""),s}function kt(){}function $(n){return n===kt}function k(n){return A(n)&&A(n.attrs)}function O(n){return!$(n.tag)&&U(n.tag)}function G(n){const{tag:t,attrs:e,children:s}=n,o={...e,children:s};let r=t;if(Lt(t)){const c=new t(o);r=c.render.bind(c)}let a=r(o);return O(a)?G(a):a}var w;(function(n){n.create="create",n.update="update",n.remove="remove"})(w||(w={}));function ot(n,t){const e=[],s=c=>Object.keys(c),o=s(n),r=s(t);for(const c of o){let m=function(p,i,l=""){if(k(p)&&k(i)){if(O(p)&&K(p,i))return ht(n,l,i),!0;l+=".children",M(p.children,(d,v)=>{const y=i.children[v];m(d,y,`${l}.${v}`)})}else return K(p,i)};var a=m;const u=n[c],f=t[c],h={key:c,newValue:u,oldValue:f};if(!r.includes(c)){e.push({type:w.create,...h});continue}m(u,f,c)||e.push({type:w.update,...h})}for(const c of r)o.includes(c)||e.push({type:w.remove,key:c,newValue:n[c],oldValue:t[c]});return e}function mt(...n){const t=[];return M(n,e=>{U(e)&&(e=e()),D(e)||t.push(e)}),t.join(" ").trim().replace(/\s+/," ")}function rt(n,t){M(t,(e,s)=>{const o=n[s];o?e.replaceWith(o):e.remove()}),M(n,(e,s)=>{n[s-1].after(e)},I(t))}function bt(n,t){t.after(...n)}function V(n){M(n,t=>{t.remove()})}function ct(n,t,e){if(t==="style"&&A(e)){for(const s in e)n[t][s]=e[s];return}t==="className"&&Nt(e)&&(e=mt(...e)),n[t]=e}const Ct=new Map;function it(n){for(const t of Ct.values()){const e=t.get(n.attrs.key||n.tag);if(e)return e}}class b{constructor(){L(this,"instance");L(this,"count");L(this,"dataMap",new WeakMap)}setInstance(t){this.count=0,this.instance=t}fixInstance(t,e){const s=this.dataMap.get(e);s&&(this.dataMap.set(t,s),this.dataMap.delete(e))}removeInstance(t){this.dataMap.delete(t)}}function C(n){n||xt("Please set the instance first")}function gt(n,t){return Object.is(n,t)}function T(n,t){if([n,t].includes(void 0))return!1;for(const e in n)if(!Object.is(n[e],t[e]))return!1;return!0}class St extends b{constructor(e){super();L(this,"option");this.option=e}use(e){const{instance:s,dataMap:o,count:r,option:a}=this;C(s);const c=o.get(s)||new Map;let u;c.has(r)||c.set(r,U(e)?e():e),u=c.get(r);const f=h=>{const m=c.get(r);h=U(h)?h(m):h,!gt(h,m)&&(c.set(r,h),a.update(s))};return o.set(s,c),this.count++,[u,f]}}class wt extends b{use(t,e){const{instance:s,dataMap:o,count:r}=this;C(s);const a=o.get(s)||new Map,c=a.get(r);if(c&&T(e,c.deps))return this.count++,c.result;const u=t();return a.set(r,{result:u,deps:e}),o.set(s,a),this.count++,u}}class It extends b{use(t,e){const{instance:s,dataMap:o,count:r}=this;C(s);const a=o.get(s)||new Map,c=a.get(r);return T(e,c.deps)?c.func:(a.set(r,{func:t,deps:e}),this.count++,t)}}class at extends b{use(t,e){const{instance:s,dataMap:o,count:r}=this;C(s);const a=o.get(s)||new Map,c=a.get(r);a.set(r,{func:t,deps:e,oldDeps:c==null?void 0:c.oldDeps,clear:c==null?void 0:c.clear}),o.set(s,a),this.count++}run(t){const e=this.dataMap.get(t);e&&e.forEach(async s=>{const{clear:o,func:r,deps:a,oldDeps:c}=s;if(a!==void 0&&T(a,c))return;o&&o();const u=r();s.clear=pt(u)?await u:u,s.oldDeps=a})}runClear(t){const e=this.dataMap.get(t);e&&e.forEach(s=>{s.clear&&s.clear()})}}class At extends b{use(t){const{instance:e,dataMap:s,count:o}=this;C(e);const r=s.get(e)||new Map;let a=r.get(o);return a||(a={current:t},r.set(o,a),s.set(e,r)),this.count++,a}}class Ot extends b{use(t,e,s){const{instance:o,dataMap:r,count:a}=this;if(C(o),!t)return;const c=r.get(o)||new Map,u=c.get(a);if(!u||!T(u.deps,s)){const f=e();t.current=f,c.set(a,{expose:f,deps:s}),r.set(o,c)}else t.current=u.expose;this.count++}}class $t extends b{constructor(){super();L(this,"ctx");const e=this.fixInstance;this.fixInstance=(s,o)=>{this.ctx&&this.ctx.replace(s,o),e.call(this,s,o)}}use(e){const{instance:s}=this;return C(s),this.ctx=e,e.append(s),e.inject()}}class Rt extends b{constructor(e){super();L(this,"option");this.option=e}use(e,s,o){const{instance:r,dataMap:a,count:c,option:u}=this;C(r);const f=a.get(r)||new Map;if(f.has(c)){const m=f.get(c);return this.count++,[m.state,m.dispatch]}s=o?o(s):s;function h(m){let p=e(s,m);function i(l){return gt(s,l)||(s=l,f.set(c,{state:s,dispatch:h}),u.update(r)),s}return pt(p)?p.then(l=>i(l)):i(p)}return f.set(c,{state:s,dispatch:h}),a.set(r,f),this.count++,[s,h]}}const H=new Map;class Pt extends b{use(t){const{instance:e}=this;C(e);const{reducer:s,handle:o,state:r,init:a,key:c,bind:u}=t;u(vt());const f=H.get(c);f?f.add(e):H.set(c,new Set([e])),s.count=0;const[h,m]=s.use(o,r,a);return{state:h,dispatch:m}}remove(t){H.forEach(e=>{e.delete(t)})}}class Wt{constructor(t={}){L(this,"option");L(this,"fragmentMap",new Map);L(this,"treeMap",new WeakMap);this.option=t}render(t){const{intercept:e}=this.option;if(e==null||e(t),!A(t))return[document.createTextNode(t)];const{tag:s}=t;return R(s)?[this.toReals(t)]:$(s)?this.toFragment(t):this.createComp(t)}toReals(t){const{nodeMount:e}=this.option,{tag:s,attrs:o,children:r}=t,a=document.createElement(s);for(const c in o)ct(a,c,o[c]);return M(r,c=>{const u=this.render(c);a.append(...u)}),e==null||e(t,a),a}toFragment(t){const e=[];return M(t.children,s=>{const o=this.render(s);e.push(...o)}),this.fragmentMap.set(t,e),e}replaceTreeMap(t,e){var o,r;(r=(o=this.option).compTreeReplace)==null||r.call(o,t,e);const s=this.treeMap.get(e);this.treeMap.set(t,s),this.treeMap.delete(e)}compTreeExec(t){const{currentCompTree:e,created:s}=this.option;e==null||e(t);const o=G(t);return s==null||s(t,o),o}createComp(t){var r,a;const e=it(t);if(e)return this.treeMap.set(t,e),e.nodes;const s=this.compTreeExec(t),o=this.render(s);return this.treeMap.set(t,{tree:s,nodes:o}),(a=(r=this.option).mount)==null||a.call(r,t,s,o),o}destroyComp(t,e=!0){var s,o;if(k(t))if(O(t)){const r=it(t),a=this.treeMap.get(t),{tree:c,nodes:u}=a;if(r){e&&V(u);return}this.destroyComp(c),(o=(s=this.option).unmount)==null||o.call(s,t,u),e&&V(u),this.treeMap.delete(t)}else M(t.children,r=>{this.destroyComp(r)})}updateComp(t){const e=this.treeMap.get(t);if(!e)return;const s=this.compTreeExec(t);this.updateTree(s,e.tree,e.nodes),e.tree=s;const{mount:o}=this.option;return o&&o(t,s,e.nodes),s}updateTree(t,e,s){const o=this;if(k(t)&&k(e)){if(t.tag!==e.tag){o.destroyComp(e,!1);const a=o.render(t);return rt(a,s),a}if($(t.tag)){const a=o.fragmentMap.get(e)||s,c=[];return M(t.children,(u,f)=>{const h=e.children[f],m=a[f];if(K(u,h)){c.push(m);return}let p=[];if(D(h)){p=o.render(u);const i=c[f-1];bt(p,i)}else{const i=o.updateTree(u,h,[m]);p.push(...i)}c.push(...p)}),M(a,u=>{u.remove()},I(t.children)),o.fragmentMap.set(t,c),o.fragmentMap.delete(e),c}if(R(t.tag)){const a=s[0],{nodeUpdate:c}=o.option;c&&c(t,e,a);const u=ot(t.attrs,e.attrs);M(u,m=>{const{type:p,key:i}=m;let l=m.newValue;p===w.remove?a.removeAttribute(i==="className"?"class":i):ct(a,i,l)});const f=ot(t.children,e.children),h=[];return M(f,m=>{const{type:p,key:i,newValue:l,oldValue:d}=m,v=a.childNodes[i];if(p===w.remove)k(d)&&O(d)?o.destroyComp(d):h.push(v);else if(p===w.create){const y=o.render(l);a.append(...y)}else{let y=[v];k(d)&&(O(d)?y=o.treeMap.get(d).nodes:$(d.tag)&&(y=a.childNodes)),o.updateTree(l,d,y)}}),M(h,m=>m.remove()),s}if(O(t)){o.replaceTreeMap(t,e);const a=o.treeMap.get(t),c=o.compTreeExec(t),u=o.updateTree(c,a.tree,s);a.tree=c;const{mount:f}=this.option;return f&&f(t,c,u),u}}if(t||o.destroyComp(e,!1),D(t))return V(s),[];const r=o.render(t);return rt(r,s),r}}function zt(n,t={}){const{intercept:e,currentCompTree:s}=t;function o(u){if(e==null||e(u),!k(u))return u;const{tag:f}=u;return R(f)?r(u):$(f)?a(u.children):c(u)}function r(u){const{tag:f,attrs:h,children:m}=u;let p="";for(const i in h){let l=h[i];if(!i.startsWith("on")){if(["innerHTML","innerText","textContent"].includes(i)){m[0]=l;continue}if(i==="className"){p+=` class="${mt(...[l].flat())}"`;continue}i==="style"&&A(l)&&(l=JSON.stringify(l).slice(1,-1).replace(/"/g,"").replace(/,/g,";")),p+=` ${i}="${l}"`}}return`<${f}${p}>${a(m)}</${f}>`}function a(u){let f="";return M(u,h=>{f+=o(h)}),f}function c(u){return s==null||s(u),o(G(u))}return o(n)}let J;function Ut(){const n={};function t(i,l){n[i]=l}const e={};function s(i,l){e[i]=l}const o={state:new St({update:c}),memo:new wt,effect:new at,callback:new It,layoutEffect:new at,ref:new At,expose:new Ot,context:new $t,reducer:new Rt({update:c}),store:new Pt},r=Object.values(o),a=new WeakMap;function c(i){const l=a.get(i)||[];l.push(1),a.set(i,l);const d=I(l);st(()=>{I(l)===d&&(u.updateComp(i),a.delete(i))})}const u=new Wt({intercept(i){if(!k(i))return;const{tag:l}=i;if(R(l)){const d=n[l];d&&(i.tag=d)}},currentCompTree(i){J=p,M(r,l=>{l.setInstance(i)})},compTreeReplace(i,l){M(r,d=>{d.fixInstance(i,l)})},created(i,l){o.effect.run(i)},mount(i,l,d){o.layoutEffect.run(i)},unmount(i,l){o.effect.runClear(i),o.layoutEffect.runClear(i),o.store.remove(i),M(r,d=>{d.removeInstance(i)})},nodeMount(i,l){const{ref:d,...v}=i.attrs;d&&(d.current=l),f(v,l)},nodeUpdate(i,l,d){st(()=>{const{ref:v,...y}=i.attrs;f(y,d)})}});function f(i,l){for(const d in i){const v=e[d];v&&v(i[d],l)}}function h(i){return u.render(i)}let m;const p={useComponent:t,useDirective:s,convert:h,render(i,l){m=i;const d=h(i);return l&&l.append(...d),d},unmount(){u.destroyComp(m)},renderToString(i){return zt(i,{intercept(l){if(!k(l))return;const{tag:d,attrs:v}=l;if(R(d)){const y=n[d];if(y)return l.tag=y;for(const P in v)e[P]&&delete v[P]}},currentCompTree(l){M(r,d=>{d.setInstance(l)})}})},use(i){return i.install(p),p},compUpdate(i){return c(i)},compResult(i){return u.treeMap.get(i)},version:"0.0.10"};return Object.setPrototypeOf(p,o),J=p,p}function vt(){return J}const j=vt,S=n=>j().state.use(n),Z=(n,t)=>j().layoutEffect.use(n,t),F=n=>j().ref.use(n),Dt=(n,t,e)=>j().expose.use(n,t,e);function Ft(n){return n.then(t=>[null,t]).catch(t=>[t,null])}const Tt="production",yt=Object.freeze({BASE_URL:"/music",NODE_ENV:Tt,API_BASE_URL:"http://trail.hpyyb.cn/trail",STATIC_BASE_URL:"http://static.hpyyb.cn"});function jt(n){const{url:t,params:e,...s}=n,o=yt.API_BASE_URL+(e?`${t}?${Object.keys(e).map(r=>`${r}=${e[r]}`).join("&")}`:t);return new Promise((r,a)=>{fetch(o,s).then(c=>{c.ok?r(c.json()):a(c)}).catch(c=>{a(c)})})}function Bt(n){return Ft(jt(n))}async function qt(){const[n,t]=await Bt({url:"/basic/api/file/catalog",params:{filename:"/music"}});if(n)return[];const e={".flac":"无损",".mp3":"标准"};return t.data.map(s=>{const[o,r]=s.name.replace(s.ext,"").split("-");return{...s,name:r,author:o,type:e[s.ext]||"未知"}})}const Vt="_container_1ezv9_1",Ht="_list_1ezv9_6",Xt="_active_1ezv9_20",Kt="_name_1ezv9_24",Jt="_ext_1ezv9_27",Zt="_author_1ezv9_32",Gt="_wrapper_1ezv9_38",Qt="_header_1ezv9_49",Yt="_info_1ezv9_54",te="_other_1ezv9_60",ee="_btns_1ezv9_68",N={container:Vt,list:Ht,active:Xt,name:Kt,ext:Jt,author:Zt,wrapper:Gt,header:Qt,info:Yt,other:te,btns:ee},ne="_progress_1lkh7_1",se="_point_1lkh7_25",ut={progress:ne,point:se};function oe(n){const[t,e]=S(0),[s,o]=S(0),[r,a]=S(!0);function c(i){o(Number((i*100).toFixed(2)))}Dt(n.ref,()=>({setLoad(i){e(Number((i*100).toFixed(2)))},setProgress(i){r&&c(i)}}));const u=F(),f=F();function h(i){if(i.target===f.current)return;const l=i.layerX/i.target.clientWidth;c(l),n.onChange(l)}function m(i){a(!1);const l=v=>{const y=(v.clientX-f.current.clientWidth*2)/u.current.clientWidth;c(y)};function d(){a(!0);const v=f.current.offsetLeft/u.current.clientWidth;n.onChange(v),document.removeEventListener("mousemove",l,!1),document.removeEventListener("mouseup",d,!1)}document.addEventListener("mousemove",l,!1),document.addEventListener("mouseup",d,!1)}function p(i){a(!1);const l=v=>{const y=(v.touches[0].clientX-f.current.clientWidth*2)/u.current.clientWidth;c(y)};function d(){a(!0);const v=f.current.offsetLeft/u.current.clientWidth;n.onChange(v),document.removeEventListener("touchmove",l,!1),document.removeEventListener("touchend",d,!1)}document.addEventListener("touchmove",l,!1),document.addEventListener("touchend",d,!1)}return g("div",{ref:u,className:ut.progress,style:`--load: ${t}%; --left: ${s}%;`,onclick:h},g("div",{ref:f,className:ut.point,onmousedown:m,ontouchstart:p}))}function re(n,t=0){return~~(Math.random()*(n-t)+t)}const ce=n=>n<10?"0"+n:n;function lt(n){const t=Math.floor(n/60),e=Math.floor(n%60);return`${t}:${ce(e)}`}const ft="_music_index_",dt="_music_mode_",X=["loop","random","single"],ie={loop:"⥧",random:"↬",single:"⤼"};function ae(){const[n,t]=S([]);if(Z(()=>{qt().then(x=>{t(x)})},[]),n.length===0)return g("div",null,"loading...");const[e,s]=S(localStorage.getItem(dt)||"loop");function o(){const x=X.indexOf(e),E=X[(x+1)%X.length];s(E),localStorage.setItem(dt,E)}const[r,a]=S(Number(localStorage.getItem(ft))||0);function c(x){let E=x;e==="random"?E=re(n.length):e==="single"&&(E=r),a(E),localStorage.setItem(ft,E+"")}const[u,f]=S("stop"),[h,m]=S({percent:0,duration:0}),p=F(null),i=F();function l(){f("play"),setTimeout(()=>{p.current.play()})}function d(){f("pause"),p.current.pause()}function v(){u==="play"?d():l()}function y(){c((r+1)%n.length),l()}function P(){c((r-1+n.length)%n.length),l()}Z(()=>{const{name:x,author:E,path:Mt}=n[r];document.title=x+" - "+E;const _=document.createElement("audio");_.preload="auto",_.src=yt.STATIC_BASE_URL+Mt,p.current=_;function Y(){m({percent:0,duration:_.duration})}function tt(){const{currentTime:W,duration:z}=_,q=W/z;i.current.setProgress(q),m({percent:W,duration:z})}function et(){const{duration:W,buffered:z}=_,q=z.end(0);i.current.setLoad(q/W)}const nt=r===n.length-1&&e==="loop"?d:y;return _.addEventListener("loadedmetadata",Y),_.addEventListener("progress",et),_.addEventListener("timeupdate",tt),_.addEventListener("ended",nt),()=>{_.removeEventListener("loadedmetadata",Y),_.removeEventListener("timeupdate",tt),_.removeEventListener("progress",et),_.removeEventListener("ended",nt),_.pause(),_.src="",_.remove(),i.current.setLoad(0),i.current.setProgress(0)}},[r]);function Q(x){const E=p.current;E.currentTime=E.duration*x,u!=="play"&&l()}const B=n[r];return g("div",{className:N.container},g("ul",{className:N.list},...n.map((x,E)=>g("li",{className:E===r?N.active:"",onclick:()=>{c(E),setTimeout(l)}},g("strong",{className:[N.name,"ellipsis"]},x.name),g("span",{className:N.ext},x.type),g("span",{className:[N.author,"ellipsis"]},x.author)))),g("div",{className:N.wrapper},g("div",{className:N.header},g("div",{className:N.info},g("strong",null,B.name)," - ",g("span",{className:N.author},B.author)),g("div",{className:N.other},g("span",null,B.type),g("span",null,lt(h.percent),"/",lt(h.duration))," ")),g(oe,{ref:i,onChange:Q}),g("div",{className:N.btns},g("span",{onclick:o},ie[e]),g("span",{onclick:()=>P()},"≪"),g("span",{onclick:()=>v()},u==="play"?"☐":"▸"),g("span",{onclick:()=>y()},"≫"))))}const ue=document.getElementById("root"),le=Ut();function fe(){return Z(()=>{const n=matchMedia("(prefers-color-scheme: dark)");t();function t(){document.documentElement.dataset.theme=n.matches?"dark":"light"}return n.addEventListener("change",t),()=>{n.removeEventListener("change",t)}},[]),g(ae,null)}le.render(g(fe,null),ue);
